 47 from django.views import generic
 46 from .models import Address
 45 from .forms import BulkImportForm
 44 from django.http import HttpResponseRedirect
 43 from django.core.urlresolvers import reverse
 42 from django.contrib import messages
 41
 40 # Create your views here.
 39
 38 class AllAddressesView(generic.ListView):
 37     template_name = 'addman/all_addresses.html'
 36     context_object_name = 'all_addresses_list'
 35     def get_queryset(self):
 34
 33         """Return all the addresses in the database."""
 32         return Address.objects.all()
 31
 30 def bulk_import_view(request):
 29     if request.method=='POST':
 28         form = BulkImportForm(request.POST)
 27         if not form.is_valid():
 26             return render(request,
 25                           'addman/bulk_import.html',
 24                            context={'form': form, })
 23         else:
 22             user_bulk_import = form.cleaned_data['bulk_addresses']
 21             user_lines = user_bulk_import.strip().split('\n')
 20             address_set_id = form.cleaned_data['address_set_select'].pk
 19             for line in user_lines:
 18                 try:
 17                     Address.objects.create(user_input=line,
 16                         address_set_id = address_set_id
 15                     )
 14                 except:
 13                     messages.error(request, "There was an error"
 12                         "importing addresses. The import was"
 11                         "stopped at:\n'%s'." % line)
 10                     return render(request,
  9                             'addman/bulk_import.html',
  8                             context={'form': form, },
  7                     )
  6             messages.success(request, "Thanks for the submission."
  5                     "Those addresses have been imported.")
  4             return HttpResponseRedirect(reverse('addman:all_addresses'))
  3
  2     else: # GET
  1         form = BulkImportForm()
49          return render(request,
  1                 'addman/bulk_import.html',
  2                 context={'form': form,}
  3         )
~
views.py                                             Wed 26 Aug 2015 09:38:13 PM PDT    49,24-30  All
django@osprey:~/django_project/addman$
django@osprey:~/django_project/addman$
